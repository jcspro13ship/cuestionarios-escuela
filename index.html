<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cuestionarios</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Sistema de almacenamiento
        if (typeof window.storage === 'undefined') {
            window.storage = {
                async get(key, shared) {
                    const k = (shared ? 's_' : 'l_') + key;
                    const v = localStorage.getItem(k);
                    if (v) return { key, value: v, shared };
                    throw new Error('Not found');
                },
                async set(key, value, shared) {
                    localStorage.setItem((shared ? 's_' : 'l_') + key, value);
                    return { key, value, shared };
                }
            };
        }

        function App() {
            const [view, setView] = useState('login');
            const [user, setUser] = useState(null);
            const [quizzes, setQuizzes] = useState([]);
            const [students, setStudents] = useState([]);
            const [results, setResults] = useState([]);
            const [editing, setEditing] = useState(null);
            const [quiz, setQuiz] = useState(null);
            const [qIdx, setQIdx] = useState(0);
            const [answers, setAnswers] = useState([]);
            const [selected, setSelected] = useState(null);
            const [showExp, setShowExp] = useState(false);
            const [loading, setLoading] = useState(true);
            const [pwd, setPwd] = useState('');

            useEffect(() => {
                (async () => {
                    try {
                        const q = await window.storage.get('quizzes', true);
                        if (q) setQuizzes(JSON.parse(q.value));
                        const s = await window.storage.get('students', true);
                        if (s) setStudents(JSON.parse(s.value));
                        const r = await window.storage.get('results', true);
                        if (r) setResults(JSON.parse(r.value));
                    } catch (e) {}
                    setLoading(false);
                })();
            }, []);

            const save = async (key, data) => {
                await window.storage.set(key, JSON.stringify(data), true);
            };

            const loginStudent = async (name, id) => {
                if (!name.trim() || !id.trim()) return alert('Completa todos los campos');
                let st = students.find(s => s.id === id);
                if (!st) {
                    st = { id, name: name.trim(), createdAt: new Date().toISOString() };
                    const newS = [...students, st];
                    setStudents(newS);
                    await save('students', newS);
                }
                setUser({ ...st, role: 'student' });
                setView('student');
            };

            const loginAdmin = () => {
                if (pwd === 'admin123') {
                    setUser({ role: 'admin', name: 'Administrador' });
                    setView('admin');
                    setPwd('');
                } else alert('Contrase√±a incorrecta');
            };

            const logout = () => { setUser(null); setView('login'); setPwd(''); };

            const createQuiz = () => {
                setEditing({ id: Date.now(), title: '', description: '', questions: [] });
                setView('edit');
            };

            const addQ = () => {
                setEditing({ ...editing, questions: [...editing.questions, { question: '', options: ['','','',''], correct: 0, explanation: '' }] });
            };

            const updateQ = (i, f, v) => {
                const qs = [...editing.questions];
                qs[i] = { ...qs[i], [f]: v };
                setEditing({ ...editing, questions: qs });
            };

            const updateOpt = (qi, oi, v) => {
                const qs = [...editing.questions];
                qs[qi].options[oi] = v;
                setEditing({ ...editing, questions: qs });
            };

            const delQ = (i) => {
                setEditing({ ...editing, questions: editing.questions.filter((_, idx) => idx !== i) });
            };

            const saveQuiz = async () => {
                if (!editing.title || !editing.questions.length) return alert('Completa t√≠tulo y preguntas');
                const idx = quizzes.findIndex(q => q.id === editing.id);
                const newQs = idx >= 0 ? quizzes.map((q, i) => i === idx ? editing : q) : [...quizzes, editing];
                setQuizzes(newQs);
                await save('quizzes', newQs);
                setEditing(null);
                setView('admin');
            };

            const delQuiz = async (id) => {
                if (!confirm('¬øEliminar este cuestionario?')) return;
                const newQs = quizzes.filter(q => q.id !== id);
                setQuizzes(newQs);
                await save('quizzes', newQs);
            };

            const startQuiz = (q) => {
                setQuiz(q);
                setQIdx(0);
                setAnswers([]);
                setSelected(null);
                setShowExp(false);
                setView('quiz');
            };

            const submitAns = () => {
                if (selected === null) return alert('Selecciona una respuesta');
                setAnswers([...answers, selected]);
                setShowExp(true);
            };

            const nextQ = async () => {
                if (qIdx < quiz.questions.length - 1) {
                    setQIdx(qIdx + 1);
                    setSelected(null);
                    setShowExp(false);
                } else {
                    let correct = 0;
                    quiz.questions.forEach((q, i) => { if (answers[i] === q.correct) correct++; });
                    const res = {
                        id: Date.now(),
                        studentId: user.id,
                        studentName: user.name,
                        quizId: quiz.id,
                        quizTitle: quiz.title,
                        score: correct,
                        total: quiz.questions.length,
                        percentage: Math.round((correct / quiz.questions.length) * 100),
                        answers,
                        date: new Date().toISOString()
                    };
                    const newR = [...results, res];
                    setResults(newR);
                    await save('results', newR);
                    setView('results');
                }
            };

            const exportCSV = () => {
                const csv = [
                    'Fecha,Estudiante,ID,Cuestionario,Puntuaci√≥n,Total,Porcentaje',
                    ...results.map(r => `"${new Date(r.date).toLocaleString('es')}","${r.studentName}","${r.studentId}","${r.quizTitle}",${r.score},${r.total},${r.percentage}%`)
                ].join('\n');
                const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `resultados_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            };

            if (loading) return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center">
                    <div className="text-center"><div className="text-6xl mb-4">üìö</div><p className="text-xl">Cargando...</p></div>
                </div>
            );

            if (view === 'login') return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6 flex items-center justify-center">
                    <div className="max-w-md w-full">
                        <div className="text-center mb-8">
                            <img src="logo.png" alt="Logo" className="w-32 h-32 mx-auto mb-4 object-contain" />
                            <h1 className="text-4xl font-bold text-gray-800 mb-2">Sistema de Cuestionarios</h1>
                            <p className="text-gray-600">Inicia sesi√≥n para continuar</p>
                        </div>
                        <div className="bg-white p-8 rounded-2xl shadow-lg mb-4">
                            <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                                <span className="text-3xl">üë§</span> Estudiante
                            </h2>
                            <form onSubmit={(e) => { e.preventDefault(); const fd = new FormData(e.target); loginStudent(fd.get('name'), fd.get('id')); }}>
                                <input name="name" placeholder="Nombre completo" className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg mb-3 focus:border-blue-500 focus:outline-none" required />
                                <input name="id" placeholder="ID de estudiante o c√©dula" className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg mb-4 focus:border-blue-500 focus:outline-none" required />
                                <button type="submit" className="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold transition">Ingresar como Estudiante</button>
                            </form>
                        </div>
                        <div className="bg-white p-8 rounded-2xl shadow-lg">
                            <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                                <span className="text-3xl">üîë</span> Administrador
                            </h2>
                            <form onSubmit={(e) => { e.preventDefault(); loginAdmin(); }}>
                                <input type="password" placeholder="Contrase√±a de administrador" value={pwd} onChange={(e) => setPwd(e.target.value)} className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg mb-4 focus:border-purple-500 focus:outline-none" required />
                                <button type="submit" className="w-full py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-semibold transition">Ingresar como Administrador</button>
                            </form>
                            <p className="text-sm text-gray-500 mt-3 text-center">Contacta al administrador para obtener la contrase√±a></p>
                        </div>
                    </div>
                </div>
            );

            if (view === 'student') {
                const myRes = results.filter(r => r.studentId === user.id);
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6">
                        <div className="max-w-4xl mx-auto">
                            <div className="flex justify-between items-center mb-6 flex-wrap gap-4">
                                <div>
                                    <h2 className="text-3xl font-bold text-gray-800">Bienvenido, {user.name}</h2>
                                    <p className="text-gray-600">ID: {user.id}</p>
                                </div>
                                <button onClick={logout} className="px-6 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 font-semibold">Salir</button>
                            </div>
                            {myRes.length > 0 && (
                                <div className="bg-white p-6 rounded-2xl shadow-lg mb-6">
                                    <h3 className="text-xl font-bold text-gray-800 mb-4">üìä Tu Progreso</h3>
                                    <div className="grid grid-cols-3 gap-4 text-center">
                                        <div className="p-4 bg-blue-50 rounded-xl">
                                            <div className="text-4xl font-bold text-blue-600">{myRes.length}</div>
                                            <div className="text-sm text-gray-600 mt-1">Intentos</div>
                                        </div>
                                        <div className="p-4 bg-green-50 rounded-xl">
                                            <div className="text-4xl font-bold text-green-600">{Math.round(myRes.reduce((s,r) => s+r.percentage,0)/myRes.length)}%</div>
                                            <div className="text-sm text-gray-600 mt-1">Promedio</div>
                                        </div>
                                        <div className="p-4 bg-purple-50 rounded-xl">
                                            <div className="text-4xl font-bold text-purple-600">{Math.max(...myRes.map(r=>r.percentage))}%</div>
                                            <div className="text-sm text-gray-600 mt-1">Mejor Nota</div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            <h3 className="text-2xl font-bold text-gray-800 mb-4">üìù Cuestionarios Disponibles</h3>
                            {quizzes.length === 0 ? (
                                <div className="text-center py-16 bg-white rounded-2xl shadow-lg">
                                    <div className="text-6xl mb-4">üì≠</div>
                                    <p className="text-gray-600 text-lg">No hay cuestionarios disponibles</p>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {quizzes.map(q => {
                                        const att = myRes.filter(r => r.quizId === q.id);
                                        const best = att.length ? Math.max(...att.map(a=>a.percentage)) : null;
                                        return (
                                            <div key={q.id} className="bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition">
                                                <div className="flex justify-between items-start mb-4 flex-wrap gap-4">
                                                    <div className="flex-1">
                                                        <h3 className="text-2xl font-bold text-gray-800 mb-2">{q.title}</h3>
                                                        <p className="text-gray-600 mb-2">{q.description}</p>
                                                        <span className="inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold">{q.questions.length} preguntas</span>
                                                    </div>
                                                    {best !== null && (
                                                        <div className="text-right bg-green-50 px-6 py-3 rounded-xl">
                                                            <div className="text-3xl font-bold text-green-600">{best}%</div>
                                                            <div className="text-xs text-gray-600">Mejor nota</div>
                                                        </div>
                                                    )}
                                                </div>
                                                <button onClick={() => startQuiz(q)} className="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold text-lg">
                                                    {att.length ? 'üîÑ Reintentar' : '‚ñ∂Ô∏è Comenzar'}
                                                </button>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (view === 'admin') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6">
                        <div className="max-w-6xl mx-auto">
                            <div className="flex justify-between items-center mb-6 flex-wrap gap-4">
                                <h2 className="text-4xl font-bold text-gray-800">üéõÔ∏è Panel de Administraci√≥n</h2>
                                <div className="flex gap-2 flex-wrap">
                                    <button onClick={() => setView('stats')} className="px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 font-semibold">üìä Estad√≠sticas</button>
                                    <button onClick={createQuiz} className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">‚ûï Nuevo Cuestionario</button>
                                    <button onClick={logout} className="px-4 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 font-semibold">Salir</button>
                                </div>
                            </div>
                            <div className="grid md:grid-cols-3 gap-4 mb-6">
                                <div className="bg-white p-6 rounded-2xl shadow-lg">
                                    <div className="text-5xl font-bold text-blue-600 mb-2">{students.length}</div>
                                    <div className="text-gray-600">Estudiantes Registrados</div>
                                </div>
                                <div className="bg-white p-6 rounded-2xl shadow-lg">
                                    <div className="text-5xl font-bold text-green-600 mb-2">{results.length}</div>
                                    <div className="text-gray-600">Intentos Totales</div>
                                </div>
                                <div className="bg-white p-6 rounded-2xl shadow-lg">
                                    <div className="text-5xl font-bold text-purple-600 mb-2">{results.length ? Math.round(results.reduce((s,r)=>s+r.percentage,0)/results.length) : 0}%</div>
                                    <div className="text-gray-600">Promedio General</div>
                                </div>
                            </div>
                            <h3 className="text-2xl font-bold text-gray-800 mb-4">üìö Cuestionarios</h3>
                            {quizzes.length === 0 ? (
                                <div className="text-center py-16 bg-white rounded-2xl shadow-lg">
                                    <div className="text-6xl mb-4">üì≠</div>
                                    <p className="text-gray-600 text-lg mb-4">No hay cuestionarios creados</p>
                                    <button onClick={createQuiz} className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">Crear Primer Cuestionario</button>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {quizzes.map(q => {
                                        const qRes = results.filter(r => r.quizId === q.id);
                                        const avg = qRes.length ? Math.round(qRes.reduce((s,r)=>s+r.percentage,0)/qRes.length) : 0;
                                        return (
                                            <div key={q.id} className="bg-white p-6 rounded-2xl shadow-lg">
                                                <div className="flex justify-between items-start flex-wrap gap-4">
                                                    <div className="flex-1">
                                                        <h3 className="text-2xl font-bold text-gray-800 mb-2">{q.title}</h3>
                                                        <p className="text-gray-600 mb-3">{q.description}</p>
                                                        <div className="flex gap-3 flex-wrap">
                                                            <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold">{q.questions.length} preguntas</span>
                                                            <span className="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-semibold">{qRes.length} intentos</span>
                                                            {qRes.length > 0 && <span className="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-semibold">Promedio: {avg}%</span>}
                                                        </div>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button onClick={() => { setEditing(q); setView('edit'); }} className="px-4 py-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 font-semibold">‚úèÔ∏è Editar</button>
                                                        <button onClick={() => delQuiz(q.id)} className="px-4 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 font-semibold">üóëÔ∏è</button>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (view === 'stats') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6">
                        <div className="max-w-6xl mx-auto">
                            <div className="flex justify-between items-center mb-6 flex-wrap gap-4">
                                <h2 className="text-4xl font-bold text-gray-800">üìä Estad√≠sticas y Resultados</h2>
                                <div className="flex gap-2">
                                    <button onClick={exportCSV} disabled={!results.length} className="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 font-semibold">‚¨áÔ∏è Exportar CSV</button>
                                    <button onClick={() => setView('admin')} className="px-6 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 font-semibold">Volver</button>
                                </div>
                            </div>
                            <div className="bg-white p-6 rounded-2xl shadow-lg mb-6">
                                <h3 className="text-2xl font-bold text-gray-800 mb-4">üìà Por Cuestionario</h3>
                                {quizzes.length === 0 ? (
                                    <p className="text-center text-gray-500 py-8">No hay cuestionarios</p>
                                ) : (
                                    <div className="space-y-3">
                                        {quizzes.map(q => {
                                            const qRes = results.filter(r => r.quizId === q.id);
                                            const avg = qRes.length ? Math.round(qRes.reduce((s,r)=>s+r.percentage,0)/qRes.length) : 0;
                                            return (
                                                <div key={q.id} className="flex justify-between items-center p-4 bg-gray-50 rounded-xl">
                                                    <div className="flex-1">
                                                        <div className="font-bold text-lg text-gray-800">{q.title}</div>
                                                        <div className="text-sm text-gray-600">{qRes.length} intentos</div>
                                                    </div>
                                                    <div className="text-right bg-blue-100 px-6 py-3 rounded-lg">
                                                        <div className="text-3xl font-bold text-blue-600">{avg}%</div>
                                                        <div className="text-xs text-gray-600">Promedio</div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                            <div className="bg-white p-6 rounded-2xl shadow-lg">
                                <h3 className="text-2xl font-bold text-gray-800 mb-4">üìã √öltimos 20 Resultados</h3>
                                {results.length === 0 ? (
                                    <p className="text-center text-gray-500 py-8">No hay resultados todav√≠a</p>
                                ) : (
                                    <div className="overflow-x-auto">
                                        <table className="w-full">
                                            <thead className="bg-gray-100">
                                                <tr>
                                                    <th className="px-4 py-3 text-left font-semibold text-gray-700">Fecha</th>
                                                    <th className="px-4 py-3 text-left font-semibold text-gray-700">Estudiante</th>
                                                    <th className="px-4 py-3 text-left font-semibold text-gray-700">Cuestionario</th>
                                                    <th className="px-4 py-3 text-center font-semibold text-gray-700">Puntuaci√≥n</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-gray-200">
                                                {results.slice().reverse().slice(0,20).map(r => (
                                                    <tr key={r.id} className="hover:bg-gray-50">
                                                        <td className="px-4 py-3 text-sm text-gray-600">{new Date(r.date).toLocaleString('es-ES')}</td>
                                                        <td className="px-4 py-3">
                                                            <div className="font-semibold text-gray-800">{r.studentName}</div>
                                                            <div className="text-xs text-gray-500">ID: {r.studentId}</div>
                                                        </td>
                                                        <td className="px-4 py-3 text-sm text-gray-800">{r.quizTitle}</td>
                                                        <td className="px-4 py-3 text-center">
                                                            <span className={`inline-block px-4 py-2 rounded-full text-sm font-bold ${
                                                                r.percentage >= 70 ? 'bg-green-100 text-green-700' :
                                                                r.percentage >= 50 ? 'bg-yellow-100 text-yellow-700' :
                                                                'bg-red-100 text-red-700'
                                                            }`}>
                                                                {r.score}/{r.total} ({r.percentage}%)
                                                            </span>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'edit') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6">
                        <div className="max-w-4xl mx-auto">
                            <h2 className="text-4xl font-bold text-gray-800 mb-6">{editing.title ? '‚úèÔ∏è Editar' : '‚ûï Nuevo'} Cuestionario</h2>
                            <div className="bg-white p-6 rounded-2xl shadow-lg mb-6">
                                <input placeholder="T√≠tulo del cuestionario" value={editing.title} onChange={(e) => setEditing({...editing, title: e.target.value})} className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg mb-4 text-xl font-bold focus:border-blue-500 focus:outline-none" />
                                <textarea placeholder="Descripci√≥n" value={editing.description} onChange={(e) => setEditing({...editing, description: e.target.value})} className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" rows="3" />
                            </div>
                            <h3 className="text-2xl font-bold text-gray-800 mb-4">‚ùì Preguntas</h3>
                            {editing.questions.map((q, i) => (
                                <div key={i} className="bg-white p-6 rounded-2xl shadow-lg mb-4">
                                    <div className="flex justify-between items-center mb-4">
                                        <span className="text-lg font-bold text-gray-700">Pregunta {i+1}</span>
                                        <button onClick={() => delQ(i)} className="px-4 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 font-semibold">üóëÔ∏è Eliminar</button>
                                    </div>
                                    <input placeholder="Escribe tu pregunta" value={q.question} onChange={(e) => updateQ(i, 'question', e.target.value)} className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg mb-4 font-semibold focus:border-blue-500 focus:outline-none" />
                                    <div className="space-y-2 mb-4">
                                        {q.options.map((opt, oi) => (
                                            <div key={oi} className="flex gap-2 items-center">
                                                <input type="radio" checked={q.correct === oi} onChange={() => updateQ(i, 'correct', oi)} className="w-5 h-5" />
                                                <input placeholder={`Opci√≥n ${oi+1}`} value={opt} onChange={(e) => updateOpt(i, oi, e.target.value)} className="flex-1 px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" />
                                            </div>
                                        ))}
                                    </div>
                                    <textarea placeholder="Explicaci√≥n de la respuesta correcta" value={q.explanation} onChange={(e) => updateQ(i, 'explanation', e.target.value)} className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" rows="2" />
                                </div>
                            ))}
                            <button onClick={addQ} className="w-full py-3 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 mb-4 font-semibold text-lg">‚ûï Agregar Pregunta</button>
                            <div className="flex gap-4">
                                <button onClick={saveQuiz} className="flex-1 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold text-lg">üíæ Guardar Cuestionario</button>
                                <button onClick={() => { setEditing(null); setView('admin'); }} className="px-6 py-3 bg-gray-200 rounded-lg hover:bg-gray-300 font-semibold">Cancelar</button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'quiz') {
                const q = quiz.questions[qIdx];
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6">
                        <div className="max-w-3xl mx-auto">
                            <div className="mb-6">
                                <div className="flex justify-between items-center mb-2 flex-wrap gap-2">
                                    <h2 className="text-2xl font-bold text-gray-800">{quiz.title}</h2>
                                    <span className="text-gray-600">Pregunta {qIdx+1} de {quiz.questions.length}</span>
                                </div>
                                <div className="w-full bg-gray-200 rounded-full h-2">
                                    <div className="bg-blue-600 h-2 rounded-full transition-all" style={{width: `${((qIdx+1)/quiz.questions.length)*100}%`}} />
                                </div>
                            </div>
                            <div className="bg-white p-8 rounded-2xl shadow-lg">
                                <h3 className="text-2xl font-semibold text-gray-800 mb-6">{q.question}</h3>
                                <div className="space-y-3 mb-6">
                                    {q.options.map((opt, i) => {
                                        let bg = 'bg-gray-50 hover:bg-gray-100';
                                        let border = 'border-gray-300';
                                        if (showExp) {
                                            if (i === q.correct) { bg = 'bg-green-100'; border = 'border-green-500'; }
                                            else if (i === selected && selected !== q.correct) { bg = 'bg-red-100'; border = 'border-red-500'; }
                                        } else if (selected === i) { bg = 'bg-blue-100'; border = 'border-blue-500'; }
                                        return (
                                            <button key={i} onClick={() => !showExp && setSelected(i)} disabled={showExp} className={`w-full p-4 ${bg} border-2 ${border} rounded-lg text-left transition-all text-lg`}>
                                                {opt}
                                            </button>
                                        );
                                    })}
                                </div>
                                {showExp && (
                                    <div className={`p-4 rounded-lg mb-6 ${selected === q.correct ? 'bg-green-50 border-2 border-green-200' : 'bg-blue-50 border-2 border-blue-200'}`}>
                                        <h4 className="font-bold text-lg mb-2">{selected === q.correct ? '‚úÖ ¬°Correcto!' : '‚ùå Respuesta incorrecta'}</h4>
                                        <p className="text-gray-700">{q.explanation}</p>
                                    </div>
                                )}
                                <div className="flex justify-end">
                                    {!showExp ? (
                                        <button onClick={submitAns} className="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold text-lg">Enviar Respuesta</button>
                                    ) : (
                                        <button onClick={nextQ} className="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold text-lg">
                                            {qIdx < quiz.questions.length - 1 ? 'Siguiente Pregunta ‚û°Ô∏è' : 'Ver Resultados üéØ'}
                                        </button>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'results') {
                let correct = 0;
                quiz.questions.forEach((q, i) => { if (answers[i] === q.correct) correct++; });
                const pct = Math.round((correct / quiz.questions.length) * 100);
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-6">
                        <div className="max-w-3xl mx-auto">
                            <div className="bg-white p-8 rounded-2xl shadow-lg text-center">
                                <div className="text-8xl mb-6">{pct >= 70 ? 'üèÜ' : pct >= 50 ? 'üëç' : 'üìö'}</div>
                                <h2 className="text-4xl font-bold text-gray-800 mb-4">¬°Cuestionario Completado!</h2>
                                <div className="mb-8">
                                    <div className={`text-7xl font-bold mb-2 ${pct >= 70 ? 'text-green-600' : pct >= 50 ? 'text-yellow-600' : 'text-red-600'}`}>{pct}%</div>
                                    <p className="text-xl text-gray-600">{correct} de {quiz.questions.length} respuestas correctas</p>
                                </div>
                                <div className="space-y-4 mb-8">
                                    {quiz.questions.map((q, i) => {
                                        const isCorrect = answers[i] === q.correct;
                                        return (
                                            <div key={i} className={`p-4 rounded-xl border-2 ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`}>
                                                <div className="flex items-start gap-3">
                                                    <div className="text-2xl">{isCorrect ? '‚úÖ' : '‚ùå'}</div>
                                                    <div className="text-left flex-1">
                                                        <p className="font-semibold text-gray-800 mb-1">{q.question}</p>
                                                        <p className="text-sm text-gray-600">
                                                            Tu respuesta: <span className={isCorrect ? 'text-green-700 font-semibold' : 'text-red-700 font-semibold'}>{q.options[answers[i]]}</span>
                                                        </p>
                                                        {!isCorrect && (
                                                            <p className="text-sm text-gray-600">
                                                                Correcta: <span className="text-green-700 font-semibold">{q.options[q.correct]}</span>
                                                            </p>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                                <div className="flex gap-4">
                                    <button onClick={() => setView('student')} className="flex-1 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold text-lg">Volver a Cuestionarios</button>
                                    <button onClick={() => startQuiz(quiz)} className="flex-1 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold text-lg">üîÑ Reintentar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
