<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fequundar - Cuestionarios</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f0f4f8;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* HEADER CON LOGO */
        .header {
            width: 100%;
            background: #0d1b2a;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px 20px;
            position: relative;
        }
        .header img {
            height: 70px;
            object-fit: contain;
        }
        .admin-btn {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.08);
            border: none;
            color: rgba(255,255,255,0.3);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 6px;
            transition: all 0.2s;
        }
        .admin-btn:hover {
            background: rgba(255,255,255,0.15);
            color: white;
        }

        .page {
            width: 100%;
            max-width: 680px;
            padding: 28px 20px;
        }

        /* CARDS */
        .card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
        }
        h2 { color: #0d1b2a; margin-bottom: 6px; font-size: 1.45rem; }
        .subtitle { color: #777; margin-bottom: 24px; font-size: 0.93rem; }

        /* FORMULARIOS */
        .form-group { margin-bottom: 16px; }
        label { display: block; font-weight: 600; margin-bottom: 6px; color: #333; font-size: 0.93rem; }
        input, select, textarea {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: border 0.2s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #1a6fc4;
        }
        textarea { resize: vertical; min-height: 70px; }

        /* BOTONES */
        .btn {
            background: #1a6fc4;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            margin-top: 6px;
            transition: background 0.2s;
            font-family: inherit;
        }
        .btn:hover { background: #155fa0; }
        .btn-secondary {
            background: white;
            color: #1a6fc4;
            border: 2px solid #1a6fc4;
            margin-top: 10px;
        }
        .btn-secondary:hover { background: #e8f0fb; }
        .btn-danger {
            background: white;
            color: #c62828;
            border: 2px solid #c62828;
            margin-top: 6px;
        }
        .btn-danger:hover { background: #ffebee; }
        .btn-sm {
            padding: 6px 14px;
            font-size: 0.85rem;
            width: auto;
            margin: 0;
        }

        /* CATÃLOGO */
        .bienvenida {
            background: #e8f0fb;
            border-radius: 10px;
            padding: 12px 16px;
            margin-bottom: 20px;
            color: #0d1b2a;
            font-size: 0.95rem;
        }
        .cuestionarios-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
        }
        @media (max-width: 480px) { .cuestionarios-grid { grid-template-columns: 1fr; } }
        .quiz-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            background: white;
        }
        .quiz-card:hover {
            border-color: #1a6fc4;
            background: #f0f5ff;
            transform: translateY(-2px);
        }
        .quiz-card .emoji { font-size: 2rem; margin-bottom: 8px; }
        .quiz-card .titulo { font-weight: 700; color: #0d1b2a; font-size: 0.97rem; }
        .quiz-card .desc { color: #666; font-size: 0.8rem; margin-top: 4px; }
        .quiz-card .npregs { color: #1a6fc4; font-size: 0.78rem; margin-top: 8px; font-weight: 600; }

        /* CUESTIONARIO ACTIVO */
        .progress { background: #e0e0e0; border-radius: 8px; height: 8px; margin-bottom: 6px; overflow: hidden; }
        .progress-bar { background: #1a6fc4; height: 100%; border-radius: 8px; transition: width 0.4s; }
        .question-counter { color: #888; font-size: 0.85rem; margin-bottom: 18px; }
        .question-card {
            background: #f6f9ff;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 14px;
            border-left: 4px solid #1a6fc4;
        }
        .question-text { font-weight: 600; margin-bottom: 12px; color: #222; font-size: 0.97rem; }
        .options label {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 400;
            margin-bottom: 4px;
            transition: background 0.15s;
            font-size: 0.93rem;
        }
        .options label:hover { background: #dde8f8; }
        .options input[type="radio"] { width: auto; accent-color: #1a6fc4; }

        /* RESULTADO */
        .result-center { text-align: center; }
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #1a6fc4;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.2rem;
            font-weight: 700;
        }
        .score-circle span { font-size: 0.82rem; font-weight: 400; }
        .result-msg { color: #444; margin-bottom: 18px; font-size: 1.05rem; }
        .success-msg { color: #2e7d32; font-weight: 600; }
        .error-msg { color: #c62828; font-weight: 600; }
        .saving-msg { color: #1a6fc4; font-style: italic; font-size: 0.9rem; }

        /* PANEL ADMIN */
        .admin-section-title {
            font-size: 1rem;
            font-weight: 700;
            color: #0d1b2a;
            margin: 22px 0 12px;
            padding-bottom: 6px;
            border-bottom: 2px solid #e0e0e0;
        }
        .quiz-admin-item {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 14px 16px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }
        .quiz-admin-item .info { flex: 1; }
        .quiz-admin-item .info strong { display: block; color: #0d1b2a; font-size: 0.95rem; }
        .quiz-admin-item .info span { color: #888; font-size: 0.82rem; }
        .quiz-admin-item .actions { display: flex; gap: 8px; }
        .pregunta-admin {
            background: #f6f9ff;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid #d0dff5;
        }
        .pregunta-admin input { margin-bottom: 6px; }
        .opciones-admin { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px; }
        @media (max-width: 480px) { .opciones-admin { grid-template-columns: 1fr; } }
        .correcta-row { display: flex; align-items: center; gap: 8px; font-size: 0.88rem; color: #555; }
        .correcta-row select { padding: 5px 8px; font-size: 0.88rem; width: auto; }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.55);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: white;
            border-radius: 16px;
            padding: 28px;
            width: 100%;
            max-width: 560px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal h3 { color: #0d1b2a; margin-bottom: 18px; font-size: 1.2rem; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<!-- HEADER -->
<div class="header">
    <img src="fequundar-logo.png" alt="Fequundar">
    <button class="admin-btn" onclick="abrirLoginAdmin()" title="Administrador">âš™ï¸</button>
</div>

<div class="page">

    <!-- 1. LOGIN ESTUDIANTE -->
    <div id="login-section" class="card">
        <h2>Bienvenido</h2>
        <p class="subtitle">Ingresa tus datos para ver los cuestionarios disponibles</p>
        <div class="form-group">
            <label>Nombre completo</label>
            <input type="text" id="inp-nombre" placeholder="Ej: Carlos RamÃ­rez"
                onkeydown="if(event.key==='Enter') document.getElementById('inp-cedula').focus()">
        </div>
        <div class="form-group">
            <label>NÃºmero de identificaciÃ³n</label>
            <input type="text" id="inp-cedula" placeholder="Ej: 1234567890"
                onkeydown="if(event.key==='Enter') entrar()">
        </div>
        <button class="btn" onclick="entrar()">Ver cuestionarios â†’</button>
    </div>

    <!-- 2. CATÃLOGO -->
    <div id="catalogo-section" class="card hidden">
        <h2>Cuestionarios disponibles</h2>
        <div class="bienvenida" id="bienvenida-msg"></div>
        <div class="cuestionarios-grid" id="cuestionarios-grid"></div>
        <button class="btn btn-secondary" onclick="cerrarSesion()" style="margin-top:20px">â† Cerrar sesiÃ³n</button>
    </div>

    <!-- 3. CUESTIONARIO ACTIVO -->
    <div id="quiz-section" class="card hidden">
        <h2 id="quiz-title"></h2>
        <p class="subtitle" id="quiz-alumno"></p>
        <div class="progress"><div class="progress-bar" id="progress-bar"></div></div>
        <p class="question-counter" id="question-counter"></p>
        <div id="questions-container"></div>
        <button class="btn" onclick="enviarRespuestas()">Enviar respuestas âœ“</button>
        <button class="btn btn-secondary" onclick="mostrarCatalogo()">â† Volver al catÃ¡logo</button>
    </div>

    <!-- 4. RESULTADO -->
    <div id="result-section" class="card hidden result-center">
        <div class="score-circle">
            <div id="score-number">0</div>
            <span>de <span id="score-total">0</span></span>
        </div>
        <h2 id="result-titulo" style="margin-bottom:8px"></h2>
        <p class="result-msg" id="result-msg"></p>
        <p class="saving-msg" id="saving-msg">ğŸ’¾ Guardando resultado...</p>
        <p id="sheets-status"></p>
        <button class="btn" onclick="mostrarCatalogo()" style="margin-top:16px">â† Hacer otro cuestionario</button>
        <button class="btn btn-secondary" onclick="cerrarSesion()">Cerrar sesiÃ³n</button>
    </div>

</div>

<!-- MODAL: LOGIN ADMIN -->
<div class="modal-overlay" id="modal-login-admin">
    <div class="modal">
        <h3>ğŸ” Acceso Administrador</h3>
        <div class="form-group">
            <label>ContraseÃ±a</label>
            <input type="password" id="inp-admin-pass" placeholder="ContraseÃ±a"
                onkeydown="if(event.key==='Enter') verificarAdmin()">
        </div>
        <button class="btn" onclick="verificarAdmin()">Entrar</button>
        <button class="btn btn-secondary" onclick="cerrarModal('modal-login-admin')">Cancelar</button>
    </div>
</div>

<!-- MODAL: PANEL ADMIN -->
<div class="modal-overlay" id="modal-admin">
    <div class="modal">
        <h3>âš™ï¸ Panel de AdministraciÃ³n</h3>

        <div class="admin-section-title">Cuestionarios actuales</div>
        <div id="admin-lista-cuestionarios"></div>

        <div class="admin-section-title">â• Crear nuevo cuestionario</div>
        <div class="form-group">
            <label>Emoji</label>
            <input type="text" id="new-emoji" placeholder="Ej: ğŸ”¬" style="width:80px">
        </div>
        <div class="form-group">
            <label>TÃ­tulo</label>
            <input type="text" id="new-titulo" placeholder="Ej: AnatomÃ­a Reproductiva">
        </div>
        <div class="form-group">
            <label>DescripciÃ³n corta</label>
            <input type="text" id="new-desc" placeholder="Ej: Ã“rganos y estructuras del sistema reproductivo">
        </div>
        <button class="btn" onclick="crearCuestionario()">Crear cuestionario vacÃ­o</button>
        <button class="btn btn-secondary" onclick="cerrarModal('modal-admin')">Cerrar panel</button>
    </div>
</div>

<!-- MODAL: EDITAR CUESTIONARIO -->
<div class="modal-overlay" id="modal-editar">
    <div class="modal">
        <h3 id="editar-titulo-modal">Editar cuestionario</h3>

        <div class="form-group">
            <label>Emoji</label>
            <input type="text" id="edit-emoji" style="width:80px">
        </div>
        <div class="form-group">
            <label>TÃ­tulo</label>
            <input type="text" id="edit-titulo">
        </div>
        <div class="form-group">
            <label>DescripciÃ³n</label>
            <input type="text" id="edit-desc">
        </div>

        <div class="admin-section-title">Preguntas</div>
        <div id="edit-preguntas-container"></div>
        <button class="btn btn-secondary btn-sm" onclick="agregarPregunta()" style="width:100%;margin-bottom:10px">
            â• Agregar pregunta
        </button>

        <button class="btn" onclick="guardarEdicion()">ğŸ’¾ Guardar cambios</button>
        <button class="btn btn-secondary" onclick="cerrarModal('modal-editar')">Cancelar</button>
    </div>
</div>

<script>
// ============================================================
// âš™ï¸ CONFIGURACIÃ“N
// ============================================================
const GOOGLE_SCRIPT_URL = 'TU_URL_DE_GOOGLE_APPS_SCRIPT_AQUI';
const ADMIN_PASSWORD    = 'fequundar2024';  // â† Cambia esta contraseÃ±a
// ============================================================

// Cuestionarios por defecto (solo se usan si no hay nada en localStorage)
const CUESTIONARIOS_DEFAULT = {
    anatomia: {
        titulo: "AnatomÃ­a Reproductiva",
        emoji: "ğŸ”¬",
        descripcion: "Ã“rganos y estructuras del sistema reproductivo",
        preguntas: [
            { pregunta: "Â¿CuÃ¡l es la funciÃ³n principal de los ovarios?", opciones: ["Producir estrÃ³geno y Ã³vulos","Transportar el Ã³vulo","Nutrir al embriÃ³n","Producir progesterona Ãºnicamente"], correcta: 0 },
            { pregunta: "Â¿CÃ³mo se llama el proceso de liberaciÃ³n del Ã³vulo?", opciones: ["MenstruaciÃ³n","OvulaciÃ³n","FecundaciÃ³n","ImplantaciÃ³n"], correcta: 1 },
            { pregunta: "Â¿DÃ³nde ocurre normalmente la fecundaciÃ³n?", opciones: ["En el Ãºtero","En el ovario","En la trompa de Falopio","En la vagina"], correcta: 2 },
            { pregunta: "Â¿CuÃ¡l es la funciÃ³n del Ãºtero?", opciones: ["Producir Ã³vulos","Alojar y nutrir al feto","Filtrar la sangre","Regular hormonas"], correcta: 1 },
            { pregunta: "Â¿QuÃ© hormona dispara la ovulaciÃ³n?", opciones: ["EstrÃ³geno","Progesterona","LH (Hormona Luteinizante)","FSH"], correcta: 2 }
        ]
    },
    ciclo: {
        titulo: "Ciclo Reproductivo",
        emoji: "ğŸ”„",
        descripcion: "Fases, hormonas y cambios del ciclo",
        preguntas: [
            { pregunta: "Â¿CuÃ¡ntos dÃ­as dura en promedio el ciclo menstrual?", opciones: ["21 dÃ­as","28 dÃ­as","35 dÃ­as","14 dÃ­as"], correcta: 1 },
            { pregunta: "Â¿QuÃ© fase sigue despuÃ©s de la menstruaciÃ³n?", opciones: ["LÃºtea","Ovulatoria","Folicular","Secretora"], correcta: 2 },
            { pregunta: "Â¿QuÃ© estructura produce progesterona tras la ovulaciÃ³n?", opciones: ["FolÃ­culo de Graaf","Cuerpo lÃºteo","Endometrio","HipÃ³fisis"], correcta: 1 },
            { pregunta: "Â¿CuÃ¡ndo es mÃ¡s probable la fecundaciÃ³n?", opciones: ["En la menstruaciÃ³n","Al inicio del ciclo","Alrededor de la ovulaciÃ³n","Al final del ciclo"], correcta: 2 },
            { pregunta: "Si no hay fecundaciÃ³n, Â¿quÃ© ocurre con el cuerpo lÃºteo?", opciones: ["Crece mÃ¡s","Se convierte en folÃ­culo","Degenera y baja la progesterona","Se mantiene igual"], correcta: 2 }
        ]
    }
};

// â”€â”€ Estado global â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let nombreAlumno  = '';
let cedulaAlumno  = '';
let quizActual    = null;
let claveActual   = '';
let respuestas    = [];
let claveEditando = '';

// â”€â”€ Cargar/guardar cuestionarios â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getCuestionarios() {
    const saved = localStorage.getItem('fequundar_cuestionarios');
    return saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(CUESTIONARIOS_DEFAULT));
}
function saveCuestionarios(data) {
    localStorage.setItem('fequundar_cuestionarios', JSON.stringify(data));
}

// â”€â”€ LOGIN ESTUDIANTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function entrar() {
    const nombre = document.getElementById('inp-nombre').value.trim();
    const cedula = document.getElementById('inp-cedula').value.trim();
    if (!nombre || !cedula) { alert('Por favor ingresa tu nombre y nÃºmero de identificaciÃ³n'); return; }
    nombreAlumno = nombre;
    cedulaAlumno = cedula;
    mostrarCatalogo();
}

function cerrarSesion() {
    nombreAlumno = '';
    cedulaAlumno = '';
    mostrar('login-section');
    document.getElementById('inp-nombre').value = '';
    document.getElementById('inp-cedula').value = '';
}

// â”€â”€ CATÃLOGO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mostrarCatalogo() {
    mostrar('catalogo-section');
    document.getElementById('bienvenida-msg').textContent =
        `ğŸ‘‹ Hola, ${nombreAlumno}. ID: ${cedulaAlumno} â€” Elige un cuestionario para comenzar.`;

    const grid = document.getElementById('cuestionarios-grid');
    grid.innerHTML = '';
    const cuestionarios = getCuestionarios();
    const claves = Object.keys(cuestionarios);

    if (claves.length === 0) {
        grid.innerHTML = '<p style="color:#888;grid-column:1/-1;text-align:center">No hay cuestionarios disponibles aÃºn.</p>';
        return;
    }
    claves.forEach(clave => {
        const d = cuestionarios[clave];
        const card = document.createElement('div');
        card.className = 'quiz-card';
        card.innerHTML = `
            <div class="emoji">${d.emoji || 'ğŸ“'}</div>
            <div class="titulo">${d.titulo}</div>
            <div class="desc">${d.descripcion}</div>
            <div class="npregs">${d.preguntas.length} preguntas</div>
        `;
        card.onclick = () => iniciarCuestionario(clave);
        grid.appendChild(card);
    });
}

// â”€â”€ CUESTIONARIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function iniciarCuestionario(clave) {
    const cuestionarios = getCuestionarios();
    claveActual = clave;
    quizActual  = cuestionarios[clave];
    respuestas  = new Array(quizActual.preguntas.length).fill(null);

    document.getElementById('quiz-title').textContent  = quizActual.emoji + ' ' + quizActual.titulo;
    document.getElementById('quiz-alumno').textContent = `${nombreAlumno}  |  ID: ${cedulaAlumno}`;
    mostrar('quiz-section');
    renderPreguntas();
}

function renderPreguntas() {
    const container = document.getElementById('questions-container');
    container.innerHTML = '';
    quizActual.preguntas.forEach((p, i) => {
        const card = document.createElement('div');
        card.className = 'question-card';
        card.innerHTML = `
            <p class="question-text">${i + 1}. ${p.pregunta}</p>
            <div class="options">
                ${p.opciones.map((op, j) => `
                    <label>
                        <input type="radio" name="q${i}" value="${j}" onchange="registrarRespuesta(${i},${j})">
                        ${op}
                    </label>`).join('')}
            </div>`;
        container.appendChild(card);
    });
    actualizarProgreso();
}

function registrarRespuesta(preg, op) {
    respuestas[preg] = op;
    actualizarProgreso();
}

function actualizarProgreso() {
    const resp  = respuestas.filter(r => r !== null).length;
    const total = quizActual.preguntas.length;
    document.getElementById('progress-bar').style.width    = (resp / total * 100) + '%';
    document.getElementById('question-counter').textContent = `${resp} de ${total} preguntas respondidas`;
}

function enviarRespuestas() {
    if (respuestas.includes(null)) { alert('Por favor responde todas las preguntas antes de enviar.'); return; }
    let correctas = 0;
    respuestas.forEach((r, i) => { if (r === quizActual.preguntas[i].correcta) correctas++; });
    const pct = Math.round(correctas / quizActual.preguntas.length * 100);

    mostrar('result-section');
    document.getElementById('score-number').textContent  = correctas;
    document.getElementById('score-total').textContent   = quizActual.preguntas.length;
    document.getElementById('result-titulo').textContent = quizActual.titulo;
    document.getElementById('sheets-status').textContent = '';
    document.getElementById('saving-msg').style.display  = 'block';
    document.getElementById('result-msg').textContent    =
        pct >= 80 ? 'ğŸ‰ Â¡Excelente trabajo!' :
        pct >= 60 ? 'ğŸ‘ Buen esfuerzo, sigue practicando' :
                    'ğŸ’ª ContinÃºa estudiando, tÃº puedes';

    enviarASheets(correctas, pct);
}

function enviarASheets(correctas, porcentaje) {
    const datos = {
        fecha       : new Date().toLocaleString('es-CO'),
        nombre      : nombreAlumno,
        cedula      : cedulaAlumno,
        cuestionario: quizActual.titulo,
        correctas   : correctas,
        total       : quizActual.preguntas.length,
        porcentaje  : porcentaje + '%',
        respuestas  : respuestas.join(',')
    };
    fetch(GOOGLE_SCRIPT_URL, {
        method : 'POST',
        mode   : 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body   : JSON.stringify(datos)
    })
    .then(() => {
        document.getElementById('saving-msg').style.display = 'none';
        document.getElementById('sheets-status').innerHTML  = '<span class="success-msg">âœ… Resultado guardado correctamente</span>';
    })
    .catch(() => {
        document.getElementById('saving-msg').style.display = 'none';
        document.getElementById('sheets-status').innerHTML  = '<span class="error-msg">âš ï¸ No se pudo guardar. Revisa la conexiÃ³n.</span>';
    });
}

// â”€â”€ ADMIN LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function abrirLoginAdmin() {
    document.getElementById('inp-admin-pass').value = '';
    document.getElementById('modal-login-admin').classList.add('active');
    setTimeout(() => document.getElementById('inp-admin-pass').focus(), 100);
}

function verificarAdmin() {
    const pass = document.getElementById('inp-admin-pass').value;
    if (pass === ADMIN_PASSWORD) {
        cerrarModal('modal-login-admin');
        abrirPanelAdmin();
    } else {
        alert('ContraseÃ±a incorrecta');
    }
}

// â”€â”€ PANEL ADMIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function abrirPanelAdmin() {
    renderAdminLista();
    document.getElementById('modal-admin').classList.add('active');
}

function renderAdminLista() {
    const cuestionarios = getCuestionarios();
    const container = document.getElementById('admin-lista-cuestionarios');
    container.innerHTML = '';
    const claves = Object.keys(cuestionarios);
    if (claves.length === 0) {
        container.innerHTML = '<p style="color:#888;margin-bottom:10px">Sin cuestionarios aÃºn.</p>';
        return;
    }
    claves.forEach(clave => {
        const d = cuestionarios[clave];
        const item = document.createElement('div');
        item.className = 'quiz-admin-item';
        item.innerHTML = `
            <div class="info">
                <strong>${d.emoji || 'ğŸ“'} ${d.titulo}</strong>
                <span>${d.preguntas.length} preguntas Â· ${d.descripcion}</span>
            </div>
            <div class="actions">
                <button class="btn btn-secondary btn-sm" onclick="abrirEditar('${clave}')">âœï¸ Editar</button>
                <button class="btn btn-danger btn-sm" onclick="eliminarCuestionario('${clave}')">ğŸ—‘ï¸</button>
            </div>`;
        container.appendChild(item);
    });
}

function crearCuestionario() {
    const emoji  = document.getElementById('new-emoji').value.trim()  || 'ğŸ“';
    const titulo = document.getElementById('new-titulo').value.trim();
    const desc   = document.getElementById('new-desc').value.trim();
    if (!titulo) { alert('El tÃ­tulo es obligatorio'); return; }

    const cuestionarios = getCuestionarios();
    const clave = 'quiz_' + Date.now();
    cuestionarios[clave] = { emoji, titulo, descripcion: desc, preguntas: [] };
    saveCuestionarios(cuestionarios);

    document.getElementById('new-emoji').value  = '';
    document.getElementById('new-titulo').value = '';
    document.getElementById('new-desc').value   = '';

    renderAdminLista();
    alert(`âœ… Cuestionario "${titulo}" creado. Ahora edÃ­talo para agregar preguntas.`);
}

function eliminarCuestionario(clave) {
    const cuestionarios = getCuestionarios();
    if (!confirm(`Â¿Eliminar "${cuestionarios[clave].titulo}"? Esta acciÃ³n no se puede deshacer.`)) return;
    delete cuestionarios[clave];
    saveCuestionarios(cuestionarios);
    renderAdminLista();
}

// â”€â”€ EDITAR CUESTIONARIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function abrirEditar(clave) {
    claveEditando = clave;
    const cuestionarios = getCuestionarios();
    const d = cuestionarios[clave];

    document.getElementById('editar-titulo-modal').textContent = 'Editar: ' + d.titulo;
    document.getElementById('edit-emoji').value  = d.emoji || '';
    document.getElementById('edit-titulo').value = d.titulo;
    document.getElementById('edit-desc').value   = d.descripcion;

    const container = document.getElementById('edit-preguntas-container');
    container.innerHTML = '';
    d.preguntas.forEach((p, i) => agregarPreguntaConDatos(p, i));

    cerrarModal('modal-admin');
    document.getElementById('modal-editar').classList.add('active');
}

function agregarPregunta() {
    const container = document.getElementById('edit-preguntas-container');
    const idx = container.querySelectorAll('.pregunta-admin').length;
    agregarPreguntaConDatos({ pregunta: '', opciones: ['','','',''], correcta: 0 }, idx);
}

function agregarPreguntaConDatos(p, idx) {
    const container = document.getElementById('edit-preguntas-container');
    const div = document.createElement('div');
    div.className = 'pregunta-admin';
    div.dataset.idx = idx;
    div.innerHTML = `
        <label style="margin-bottom:4px;font-size:0.85rem">Pregunta ${idx + 1}</label>
        <input type="text" class="p-texto" placeholder="Escribe la pregunta aquÃ­" value="${escHtml(p.pregunta)}">
        <div class="opciones-admin">
            <input type="text" class="p-op" placeholder="OpciÃ³n A" value="${escHtml(p.opciones[0] || '')}">
            <input type="text" class="p-op" placeholder="OpciÃ³n B" value="${escHtml(p.opciones[1] || '')}">
            <input type="text" class="p-op" placeholder="OpciÃ³n C" value="${escHtml(p.opciones[2] || '')}">
            <input type="text" class="p-op" placeholder="OpciÃ³n D" value="${escHtml(p.opciones[3] || '')}">
        </div>
        <div class="correcta-row">
            <span>Respuesta correcta:</span>
            <select class="p-correcta">
                <option value="0" ${p.correcta===0?'selected':''}>A</option>
                <option value="1" ${p.correcta===1?'selected':''}>B</option>
                <option value="2" ${p.correcta===2?'selected':''}>C</option>
                <option value="3" ${p.correcta===3?'selected':''}>D</option>
            </select>
            <button class="btn btn-danger btn-sm" onclick="this.closest('.pregunta-admin').remove();renumerarPreguntas()">ğŸ—‘ï¸ Eliminar</button>
        </div>`;
    container.appendChild(div);
}

function renumerarPreguntas() {
    document.querySelectorAll('.pregunta-admin').forEach((div, i) => {
        div.querySelector('label').textContent = `Pregunta ${i + 1}`;
    });
}

function guardarEdicion() {
    const emoji  = document.getElementById('edit-emoji').value.trim()  || 'ğŸ“';
    const titulo = document.getElementById('edit-titulo').value.trim();
    const desc   = document.getElementById('edit-desc').value.trim();
    if (!titulo) { alert('El tÃ­tulo es obligatorio'); return; }

    const preguntas = [];
    let valido = true;
    document.querySelectorAll('.pregunta-admin').forEach(div => {
        const texto   = div.querySelector('.p-texto').value.trim();
        const ops     = [...div.querySelectorAll('.p-op')].map(i => i.value.trim());
        const correcta = parseInt(div.querySelector('.p-correcta').value);
        if (!texto || ops.some(o => !o)) { valido = false; return; }
        preguntas.push({ pregunta: texto, opciones: ops, correcta });
    });

    if (!valido) { alert('Por favor completa todos los campos de cada pregunta y sus opciones.'); return; }
    if (preguntas.length === 0) { alert('Agrega al menos una pregunta.'); return; }

    const cuestionarios = getCuestionarios();
    cuestionarios[claveEditando] = { emoji, titulo, descripcion: desc, preguntas };
    saveCuestionarios(cuestionarios);

    cerrarModal('modal-editar');
    abrirPanelAdmin();
    alert(`âœ… Cuestionario "${titulo}" guardado con ${preguntas.length} preguntas.`);
}

// â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mostrar(id) {
    ['login-section','catalogo-section','quiz-section','result-section']
        .forEach(s => document.getElementById(s).classList.toggle('hidden', s !== id));
}
function cerrarModal(id) {
    document.getElementById(id).classList.remove('active');
}
function escHtml(str) {
    return String(str).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}
</script>
</body>
</html>
