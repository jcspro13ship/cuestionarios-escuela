<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuestionarios Escuela</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f0f4f8;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 640px;
            width: 100%;
            box-shadow: 0 4px 24px rgba(0,0,0,0.10);
        }
        h1 {
            color: #1a237e;
            margin-bottom: 8px;
            font-size: 1.6rem;
        }
        .subtitle {
            color: #666;
            margin-bottom: 24px;
            font-size: 0.95rem;
        }
        .form-group {
            margin-bottom: 16px;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: #333;
        }
        input, select {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.2s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #3f51b5;
        }
        .btn {
            background: #3f51b5;
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            margin-top: 8px;
            transition: background 0.2s;
        }
        .btn:hover { background: #303f9f; }
        .btn:disabled { background: #9fa8da; cursor: not-allowed; }

        /* Cuestionario */
        #quiz-section { display: none; }
        .question-card {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            border-left: 4px solid #3f51b5;
        }
        .question-text {
            font-weight: 600;
            margin-bottom: 12px;
            color: #222;
        }
        .options label {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 400;
            margin-bottom: 4px;
            transition: background 0.15s;
        }
        .options label:hover { background: #e8eaf6; }
        .options input[type="radio"] {
            width: auto;
            accent-color: #3f51b5;
        }
        .progress {
            background: #e0e0e0;
            border-radius: 8px;
            height: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress-bar {
            background: #3f51b5;
            height: 100%;
            border-radius: 8px;
            transition: width 0.4s;
        }
        .question-counter {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        /* Resultado */
        #result-section { display: none; text-align: center; }
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #3f51b5;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
            font-weight: 700;
        }
        .score-circle span { font-size: 0.85rem; font-weight: 400; }
        .result-msg { color: #444; margin-bottom: 20px; font-size: 1.05rem; }
        .sending-msg { color: #3f51b5; font-style: italic; margin-bottom: 10px; }
        .success-msg { color: #2e7d32; font-weight: 600; }
        .error-msg { color: #c62828; font-weight: 600; }
    </style>
</head>
<body>
<div class="container">

    <!-- Secci√≥n de inicio -->
    <div id="start-section">
        <h1>üìö Cuestionarios Escuela</h1>
        <p class="subtitle">Completa tus datos para comenzar</p>

        <div class="form-group">
            <label>Nombre completo</label>
            <input type="text" id="nombre" placeholder="Ej: Mar√≠a Garc√≠a L√≥pez">
        </div>
        <div class="form-group">
            <label>Grado</label>
            <select id="grado">
                <option value="">-- Selecciona --</option>
                <option>1¬∞ Primaria</option>
                <option>2¬∞ Primaria</option>
                <option>3¬∞ Primaria</option>
                <option>4¬∞ Primaria</option>
                <option>5¬∞ Primaria</option>
                <option>6¬∞ Primaria</option>
                <option>1¬∞ Secundaria</option>
                <option>2¬∞ Secundaria</option>
                <option>3¬∞ Secundaria</option>
            </select>
        </div>
        <div class="form-group">
            <label>Cuestionario</label>
            <select id="cuestionario">
                <option value="">-- Selecciona --</option>
                <option value="matematicas">Matem√°ticas</option>
                <option value="ciencias">Ciencias Naturales</option>
                <option value="espa√±ol">Espa√±ol</option>
                <option value="historia">Historia</option>
            </select>
        </div>

        <button class="btn" onclick="iniciarCuestionario()">Comenzar ‚Üí</button>
    </div>

    <!-- Secci√≥n del cuestionario -->
    <div id="quiz-section">
        <h1 id="quiz-title">Cuestionario</h1>
        <p class="subtitle" id="quiz-alumno"></p>
        <div class="progress"><div class="progress-bar" id="progress-bar"></div></div>
        <p class="question-counter" id="question-counter"></p>
        <div id="questions-container"></div>
        <button class="btn" id="btn-enviar" onclick="enviarRespuestas()">Enviar respuestas</button>
    </div>

    <!-- Secci√≥n de resultado -->
    <div id="result-section">
        <div class="score-circle">
            <div id="score-number">0</div>
            <span>de <span id="score-total">0</span></span>
        </div>
        <p class="result-msg" id="result-msg"></p>
        <p class="sending-msg" id="sending-msg">Guardando resultados...</p>
        <p id="sheets-status"></p>
        <button class="btn" onclick="reiniciar()" style="margin-top:20px">Hacer otro cuestionario</button>
    </div>

</div>

<script>
// ============================================================
// ‚öôÔ∏è CONFIGURACI√ìN - Solo cambia esta URL
// ============================================================
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzW3XSoDR3hYRMLQpMWY7y1u9TLkIpzXckNzSyIB-qb3MEg_awCm7E-4KUDk_K51_k/exec';
// ============================================================

// Base de preguntas por cuestionario
const PREGUNTAS = {
    matematicas: [
        { pregunta: "¬øCu√°nto es 7 √ó 8?", opciones: ["54", "56", "64", "48"], correcta: 1 },
        { pregunta: "¬øQu√© fracci√≥n es mayor?", opciones: ["1/2", "1/3", "1/4", "1/5"], correcta: 0 },
        { pregunta: "¬øCu√°nto es 144 √∑ 12?", opciones: ["11", "13", "12", "14"], correcta: 2 },
        { pregunta: "¬øCu√°l es el √°rea de un cuadrado de lado 5?", opciones: ["10", "20", "25", "15"], correcta: 2 },
        { pregunta: "¬øCu√°nto es 15% de 200?", opciones: ["25", "30", "35", "20"], correcta: 1 },
    ],
    ciencias: [
        { pregunta: "¬øCu√°l es el planeta m√°s grande del sistema solar?", opciones: ["Saturno", "J√∫piter", "Neptuno", "Urano"], correcta: 1 },
        { pregunta: "¬øQu√© proceso usan las plantas para hacer su alimento?", opciones: ["Respiraci√≥n", "Digesti√≥n", "Fotos√≠ntesis", "Osmosis"], correcta: 2 },
        { pregunta: "¬øCu√°ntos huesos tiene el cuerpo humano adulto?", opciones: ["106", "206", "306", "156"], correcta: 1 },
        { pregunta: "¬øQu√© √≥rgano bombea la sangre?", opciones: ["Pulm√≥n", "H√≠gado", "Ri√±√≥n", "Coraz√≥n"], correcta: 3 },
        { pregunta: "¬øCu√°l es la f√≥rmula qu√≠mica del agua?", opciones: ["CO2", "H2O", "O2", "NaCl"], correcta: 1 },
    ],
    espa√±ol: [
        { pregunta: "¬øCu√°l es el sujeto en: 'Los ni√±os juegan en el parque'?", opciones: ["juegan", "parque", "Los ni√±os", "en el parque"], correcta: 2 },
        { pregunta: "¬øQu√© tipo de palabra es 'r√°pidamente'?", opciones: ["Sustantivo", "Adjetivo", "Adverbio", "Verbo"], correcta: 2 },
        { pregunta: "¬øCu√°l palabra est√° bien escrita?", opciones: ["Hav√≠a", "Hab√≠a", "Abia", "Habia"], correcta: 1 },
        { pregunta: "¬øQu√© signo va al inicio de una pregunta en espa√±ol?", opciones: ["?", "¬ø", "¬°", "!"], correcta: 1 },
        { pregunta: "Un sin√≥nimo de 'feliz' es:", opciones: ["Triste", "Enojado", "Contento", "Asustado"], correcta: 2 },
    ],
    historia: [
        { pregunta: "¬øEn qu√© a√±o lleg√≥ Col√≥n a Am√©rica?", opciones: ["1392", "1492", "1592", "1292"], correcta: 1 },
        { pregunta: "¬øQui√©n fue el primer presidente de M√©xico?", opciones: ["Benito Ju√°rez", "Guadalupe Victoria", "Porfirio D√≠az", "Miguel Hidalgo"], correcta: 1 },
        { pregunta: "¬øCu√°ndo fue la Revoluci√≥n Francesa?", opciones: ["1689", "1776", "1789", "1799"], correcta: 2 },
        { pregunta: "¬øQu√© civilizaci√≥n construy√≥ las pir√°mides de Egipto?", opciones: ["Griegos", "Romanos", "Egipcios", "Persas"], correcta: 2 },
        { pregunta: "¬øQui√©n escribi√≥ 'El Quijote'?", opciones: ["Lope de Vega", "Cervantes", "Quevedo", "G√≥ngora"], correcta: 1 },
    ]
};

let datosAlumno = {};
let preguntasActuales = [];
let respuestas = [];

function iniciarCuestionario() {
    const nombre = document.getElementById('nombre').value.trim();
    const grado = document.getElementById('grado').value;
    const cuestionario = document.getElementById('cuestionario').value;

    if (!nombre || !grado || !cuestionario) {
        alert('Por favor completa todos los campos');
        return;
    }

    datosAlumno = { nombre, grado, cuestionario };
    preguntasActuales = PREGUNTAS[cuestionario];
    respuestas = new Array(preguntasActuales.length).fill(null);

    document.getElementById('quiz-title').textContent =
        document.getElementById('cuestionario').options[document.getElementById('cuestionario').selectedIndex].text;
    document.getElementById('quiz-alumno').textContent = `Alumno: ${nombre} | ${grado}`;

    renderPreguntas();

    document.getElementById('start-section').style.display = 'none';
    document.getElementById('quiz-section').style.display = 'block';
}

function renderPreguntas() {
    const container = document.getElementById('questions-container');
    container.innerHTML = '';

    preguntasActuales.forEach((p, i) => {
        const card = document.createElement('div');
        card.className = 'question-card';
        card.innerHTML = `
            <p class="question-text">${i + 1}. ${p.pregunta}</p>
            <div class="options">
                ${p.opciones.map((op, j) => `
                    <label>
                        <input type="radio" name="q${i}" value="${j}" onchange="registrarRespuesta(${i}, ${j})">
                        ${op}
                    </label>
                `).join('')}
            </div>
        `;
        container.appendChild(card);
    });

    actualizarProgreso();
}

function registrarRespuesta(pregunta, opcion) {
    respuestas[pregunta] = opcion;
    actualizarProgreso();
}

function actualizarProgreso() {
    const respondidas = respuestas.filter(r => r !== null).length;
    const total = preguntasActuales.length;
    const pct = (respondidas / total) * 100;
    document.getElementById('progress-bar').style.width = pct + '%';
    document.getElementById('question-counter').textContent =
        `${respondidas} de ${total} preguntas respondidas`;
}

function enviarRespuestas() {
    if (respuestas.includes(null)) {
        alert('Por favor responde todas las preguntas antes de enviar.');
        return;
    }

    // Calcular puntaje
    let correctas = 0;
    respuestas.forEach((r, i) => {
        if (r === preguntasActuales[i].correcta) correctas++;
    });

    // Mostrar resultado
    document.getElementById('quiz-section').style.display = 'none';
    document.getElementById('result-section').style.display = 'block';
    document.getElementById('score-number').textContent = correctas;
    document.getElementById('score-total').textContent = preguntasActuales.length;

    const pct = Math.round((correctas / preguntasActuales.length) * 100);
    let msg = '';
    if (pct >= 80) msg = 'üéâ ¬°Excelente trabajo!';
    else if (pct >= 60) msg = 'üëç Buen esfuerzo, sigue practicando';
    else msg = 'üí™ Contin√∫a estudiando, t√∫ puedes';
    document.getElementById('result-msg').textContent = msg;

    // Enviar a Google Sheets
    enviarASheets(correctas, pct);
}

function enviarASheets(correctas, porcentaje) {
    const datos = {
        fecha: new Date().toLocaleString('es-MX'),
        nombre: datosAlumno.nombre,
        grado: datosAlumno.grado,
        cuestionario: datosAlumno.cuestionario,
        correctas: correctas,
        total: preguntasActuales.length,
        porcentaje: porcentaje + '%',
        respuestas: respuestas.join(',')
    };

    fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(datos)
    })
    .then(() => {
        document.getElementById('sending-msg').style.display = 'none';
        document.getElementById('sheets-status').innerHTML =
            '<span class="success-msg">‚úÖ Resultado guardado correctamente</span>';
    })
    .catch(() => {
        document.getElementById('sending-msg').style.display = 'none';
        document.getElementById('sheets-status').innerHTML =
            '<span class="error-msg">‚ö†Ô∏è No se pudo guardar. Revisa la conexi√≥n.</span>';
    });
}

function reiniciar() {
    document.getElementById('result-section').style.display = 'none';
    document.getElementById('start-section').style.display = 'block';
    document.getElementById('nombre').value = '';
    document.getElementById('grado').value = '';
    document.getElementById('cuestionario').value = '';
    document.getElementById('sending-msg').style.display = 'block';
    document.getElementById('sheets-status').textContent = '';
}
</script>
</body>
</html>
